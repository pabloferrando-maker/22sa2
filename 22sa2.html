<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refugio Qu칤mico - Tema 2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos del Pip-Boy */
        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: #000;
            color: #20ff20; /* Verde Fallout */
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            overflow: hidden;
        }

        #pipboy-container {
            width: 100%;
            max-width: 900px;
            border: 4px solid #20ff20;
            border-radius: 10px;
            background: #020a02;
            padding: 1.5rem;
            box-shadow: 0 0 20px #20ff20, inset 0 0 15px #20ff20;
            position: relative;
            overflow: hidden; /* Para el efecto de scanlines */
        }

        /* Efecto de Scanlines */
        #pipboy-container::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                to bottom,
                rgba(0, 0, 0, 0),
                rgba(0, 0, 0, 0) 1px,
                rgba(32, 255, 32, 0.1) 2px, /* L칤nea de scan */
                rgba(32, 255, 32, 0.1) 3px
            );
            opacity: 0.6;
            animation: flicker 0.15s infinite;
        }

        /* Animaci칩n de parpadeo */
        @keyframes flicker {
            0% { opacity: 0.5; }
            20% { opacity: 0.6; }
            40% { opacity: 0.5; }
            60% { opacity: 0.7; }
            80% { opacity: 0.5; }
            100% { opacity: 0.6; }
        }

        h1, h2, h3 {
            text-shadow: 0 0 8px #20ff20;
            text-transform: uppercase;
        }

        .screen {
            display: none; /* Oculto por defecto */
        }

        .screen.active {
            display: block;
        }

        /* Botones y Opciones */
        .pip-button,
        #answers-list li {
            border: 2px solid #20ff20;
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }

        .pip-button:hover,
        #answers-list li:hover {
            background-color: #20ff20;
            color: #000;
            box-shadow: 0 0 15px #20ff20;
            text-shadow: none;
        }

        .pip-button[disabled] {
            border-color: #108010;
            color: #108010;
            cursor: not-allowed;
            text-shadow: none;
        }
        .pip-button[disabled]:hover {
            background-color: transparent;
            color: #108010;
            box-shadow: none;
        }

        /* Stats del Quiz */
        #quiz-stats {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #20ff20;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        /* Feedback */
        #feedback-message {
            margin-top: 1rem;
            padding: 1rem;
            font-size: 1.1rem;
            border: 2px dashed #20ff20;
        }
        .feedback-correct {
            color: #20ff20;
            border-color: #20ff20;
            text-shadow: 0 0 5px #20ff20;
        }
        .feedback-incorrect {
            color: #ff4040;
            border-color: #ff4040;
            text-shadow: 0 0 5px #ff4040;
        }

        /* Inputs del C칩digo Final */
        .code-input {
            width: 4rem;
            height: 4rem;
            background: #000;
            border: 2px solid #20ff20;
            color: #20ff20;
            font-size: 2rem;
            text-align: center;
            margin: 0 0.25rem;
            font-family: 'Share Tech Mono', monospace;
            box-shadow: 0 0 10px #20ff20;
        }

        /* Ocultar flechas en input number */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

    </style>
</head>
<body>

    <div id="pipboy-container">

        <!-- Cabecera del Terminal -->
        <header id="header" class="flex justify-between items-center border-b-2 border-green-500 pb-2 mb-4">
            <h1 class="text-2xl md:text-3xl">TERMINAL VAULT-TEC (Mod. QUIM-3000)</h1>
            <div id="status-light" class="w-4 h-4 bg-green-500 rounded-full animate-pulse shadow-[0_0_10px_#20ff20]"></div>
        </header>

        <!-- Pantalla de Introducci칩n -->
        <div id="intro-screen" class="screen active text-center">
            <h2 class="text-2xl mb-4">> INICIANDO PROTOCOLO DE EXAMEN <</h2>
            <p class="mb-6 text-lg">춰Atenci칩n, Morador! Tu supervisor ha detectado niveles an칩malos de desconocimiento qu칤mico. Completa los 4 m칩dulos de este terminal para demostrar tu aptitud y conseguir una bonificaci칩n de 0,5 puntos para tu pr칩ximo examen.</p>
            <p class="mb-6 text-lg">Fallar 5 veces en un m칩dulo resultar치 en un fallo cr칤tico del sistema y deber치s reiniciar el m칩dulo.</p>
            <p class="mb-8 text-lg text-yellow-400 shadow-[0_0_10px_#ffff00]">Recuperar치s tus 5 puntos de integridad (vidas) al iniciar cada nuevo m칩dulo.</p>
            <div id="start-button" class="pip-button w-full md:w-1/2 mx-auto">
                ACCEDER A M칍DULOS
            </div>
        </div>

        <!-- Pantalla de Selecci칩n de Secci칩n -->
        <div id="section-screen" class="screen">
            <h2 class="text-2xl mb-4">> M칍DULOS DE FORMACI칍N <</h2>
            <p class="mb-6">Selecciona un m칩dulo. Completa los 4 para desbloquear la esclusa de bonificaci칩n.</p>
            <div id="section-buttons" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Los botones se generan con JS -->
            </div>
            <div id="goto-code-screen-button" class="pip-button w-full md:w-1/2 mx-auto mt-8 hidden">
                > IR A ESCLUSA DE BONIFICACI칍N <
            </div>
        </div>

        <!-- Pantalla de Quiz -->
        <div id="quiz-screen" class="screen">
            <div id="quiz-stats">
                <span id="section-title">M칩dulo X</span>
                <span id="question-counter">Pregunta X/10</span>
                <span id="lives-counter">Integridad: 仇벒잺仇벒잺仇벒잺仇벒잺仇벒잺</span>
            </div>
            <h3 id="question-text" class="text-xl md:text-2xl my-6 min-h-[5rem]">Cargando pregunta...</h3>
            <ul id="answers-list" class="list-none p-0">
                <!-- Opciones de respuesta generadas por JS -->
            </ul>
            <div id="feedback-message" class="hidden"></div>
        </div>

        <!-- Pantalla de Game Over (Secci칩n) -->
        <div id="gameover-screen" class="screen text-center">
            <h2 class="text-3xl text-red-500 shadow-[0_0_10px_#ff0000] mb-6">춰춰FALLO CR칈TICO DEL SISTEMA!!</h2>
            <p class="text-xl mb-6">Has agotado tus intentos. La integridad del m칩dulo est치 comprometida.</p>
            <p class="mb-8">Debes reiniciar el m칩dulo para intentarlo de nuevo.</p>
            <div id="restart-section-button" class="pip-button w-full md:w-1/2 mx-auto mb-4">
                REINICIAR M칍DULO
            </div>
            <div id="back-to-menu-button" class="pip-button w-full md:w-1/2 mx-auto">
                VOLVER AL MEN칔 DE M칍DULOS
            </div>
        </div>

        <!-- Pantalla de Secci칩n Completada -->
        <div id="section-complete-screen" class="screen text-center">
            <h2 class="text-3xl mb-6">> M칍DULO COMPLETADO <</h2>
            <p class="text-xl mb-6">Has superado el m칩dulo. Se te ha transferido un fragmento del c칩digo de anulaci칩n.</p>
            <p class="text-5xl font-bold my-8" id="earned-digit-text">#</p>
            <p class="mb-8">Anota este d칤gito. Lo necesitar치s cuando hayas completado todos los m칩dulos.</p>
            <div id="next-section-button" class="pip-button w-full md:w-1/2 mx-auto">
                VOLVER AL MEN칔 DE M칍DULOS
            </div>
        </div>
        
        <!-- Pantalla de C칩digo Final -->
        <div id="final-code-screen" class="screen text-center">
            <h2 class="text-3xl mb-4">> ESCLUSA DE BONIFICACI칍N <</h2>
            <p class="text-xl mb-6">Introduce los 4 d칤gitos obtenidos en orden (M칩dulo 1 al 4) para reclamar tu bonificaci칩n.</p>
            <p class="text-lg mb-4">D칤gitos obtenidos:</p>
            <h3 class="text-2xl mb-8" id="final-digits-display">? - ? - ? - ?</h3>
            <div>
                <input type="number" id="code-1" class="code-input" maxlength="1" oninput="moveToNext(this, 'code-2')">
                <input type="number" id="code-2" class="code-input" maxlength="1" oninput="moveToNext(this, 'code-3')">
                <input type="number" id="code-3" class="code-input" maxlength="1" oninput="moveToNext(this, 'code-4')">
                <input type="number" id="code-4" class="code-input" maxlength="1">
            </div>
            <p id="code-error-message" class="text-red-500 my-4 h-6"></p>
            <div id="check-code-button" class="pip-button w-full md:w-1/2 mx-auto mt-6">
                VALIDAR C칍DIGO
            </div>
             <div id="back-to-menu-from-code-button" class="pip-button w-full md:w-1/2 mx-auto mt-4">
                VOLVER AL MEN칔
            </div>
        </div>

        <!-- Pantalla de Victoria Final -->
        <div id="win-screen" class="screen text-center">
            <h2 class="text-4xl text-yellow-400 shadow-[0_0_20px_#ffff00] mb-6">춰춰C칍DIGO ACEPTADO!!</h2>
            <p class="text-2xl mb-6">Has demostrado tu competencia. Tu supervisor ha sido notificado.</p>
            <p class="text-3xl font-bold my-10 p-4 border-4 border-yellow-400">BONIFICACI칍N DE +0,5 PUNTOS APLICADA</p>
            <p class="text-xl">춰Buen trabajo, Morador! Puedes cerrar el terminal.</p>
        </div>

    </div>

    <script>
        // --- BASE DE DATOS DEL QUIZ (Basada en el PDF) ---
        const quizData = [
            {
                name: "M칩dulo 1: Conceptos del Yermo",
                codeDigit: 7,
                completed: false,
                questions: [
                    {
                        question: "Si quemas un trozo de madera, 쯤u칠 tipo de cambio ocurre?",
                        options: ["Cambio F칤sico", "Cambio Qu칤mico", "Cambio Nuclear", "Cambio de Estado"],
                        answer: 1,
                        explanation: "춰Radiaci칩n incorrecta! La madera desaparece y se transforma en cenizas y gases (sustancias nuevas). Es un cambio qu칤mico."
                    },
                    {
                        question: "Disolver az칰car en agua es un...",
                        options: ["Cambio Qu칤mico", "Compuesto", "Cambio F칤sico", "Reacci칩n"],
                        answer: 2,
                        explanation: "Negativo. El az칰car sigue siendo az칰car y el agua sigue siendo agua, solo est치n mezclados. Es un cambio f칤sico."
                    },
                    {
                        question: "El Oro (Au) es un ejemplo de...",
                        options: ["Compuesto", "Mezcla", "Sustancia Elemental", "Reacci칩n"],
                        answer: 2,
                        explanation: "Error. El Oro (Au) est치 formado por un solo tipo de 치tomo (Au). Es una sustancia elemental."
                    },
                    {
                        question: "El Agua (H2O) es un...",
                        options: ["Compuesto", "Elemento", "Mezcla Heterog칠nea", "Cambio F칤sico"],
                        answer: 0,
                        explanation: "Fallo. El H2O est치 formado por la uni칩n qu칤mica de dos elementos (H y O). Es un compuesto."
                    },
                    {
                        question: "Propiedad de los cambios qu칤micos:",
                        options: ["Son f치ciles de revertir", "La sustancia no cambia", "Aparecen sustancias nuevas", "Solo cambia la forma"],
                        answer: 2,
                        explanation: "춰Incorrecto! La caracter칤stica principal de un cambio qu칤mico (reacci칩n) es que la sustancia original se transforma en sustancias nuevas."
                    },
                    {
                        question: "쮺칩mo NO se puede descomponer una sustancia elemental?",
                        options: ["Por m칠todos f칤sicos", "Por m칠todos qu칤micos", "Calentando", "Mezclando"],
                        answer: 1,
                        explanation: "춰Exacto! Pero has fallado. Los elementos (como Fe, O) son la base y no se pueden descomponer en algo m치s simple por m칠todos qu칤micos."
                    },
                    {
                        question: "El Di칩xido de Carbono (CO2) es un ejemplo de...",
                        options: ["Elemento", "Sustancia Elemental", "Mezcla", "Compuesto"],
                        answer: 3,
                        explanation: "Error del sistema. El CO2 est치 formado por Carbono (C) y Ox칤geno (O) unidos qu칤micamente. Es un compuesto."
                    },
                    {
                        question: "Propiedad de los cambios f칤sicos:",
                        options: ["Son dif칤ciles de revertir", "La sustancia sigue siendo la misma", "Aparece CO2", "Se forman elementos"],
                        answer: 1,
                        explanation: "Fallo. En un cambio f칤sico (ej. fundir hielo), la sustancia (agua) no cambia su identidad (sigue siendo H2O)."
                    },
                    {
                        question: "El Ox칤geno (O2) que respiramos es...",
                        options: ["Un compuesto", "Una mezcla", "Una sustancia elemental", "Un cambio qu칤mico"],
                        answer: 2,
                        explanation: "Negativo. Aunque sean dos 치tomos (O), ambos son del mismo tipo (Ox칤geno). Por tanto, es una sustancia elemental."
                    },
                    {
                        question: "쮺칩mo se pueden descomponer los compuestos?",
                        options: ["Filtrando", "Mediante reacciones qu칤micas", "Agitando", "No se pueden descomponer"],
                        answer: 1,
                        explanation: "춰Incorrecto! Los compuestos (como H2O) solo se pueden romper en sus elementos (H y O) mediante reacciones qu칤micas (ej. electr칩lisis)."
                    }
                ]
            },
            {
                name: "M칩dulo 2: Ley de Lavoisier",
                codeDigit: 3,
                completed: false,
                questions: [
                    {
                        question: "En una ecuaci칩n qu칤mica, 쯗칩nde se escriben los REACTIVOS?",
                        options: ["A la derecha de la flecha", "Encima de la flecha", "A la izquierda de la flecha", "No se escriben"],
                        answer: 2,
                        explanation: "Error. Los REACTIVOS son las sustancias iniciales y se escriben SIEMPRE a la izquierda de la flecha."
                    },
                    {
                        question: "En $A + B \rightarrow C + D$, 쯤u칠 son C y D?",
                        options: ["Reactivos", "Productos", "Catalizadores", "Elementos"],
                        answer: 1,
                        explanation: "Negativo. Las sustancias que se obtienen (a la derecha de la flecha) son los PRODUCTOS."
                    },
                    {
                        question: "La Ley de Lavoisier tambi칠n se llama...",
                        options: ["Ley de la Gravedad", "Ley de Conservaci칩n de la Masa", "Ley de los Gases", "Ley de la Velocidad"],
                        answer: 1,
                        explanation: "Fallo. Lavoisier demostr칩 que la masa total no cambia. Es la Ley de Conservaci칩n de la Masa."
                    },
                    {
                        question: "Seg칰n Lavoisier, en una reacci칩n qu칤mica, la materia...",
                        options: ["Se crea", "Se destruye", "Ni se crea ni se destruye, solo se transforma", "Se duplica"],
                        answer: 2,
                        explanation: "춰Radiaci칩n! "En una reacci칩n qu칤mica, la materia ni se crea ni se destruye, solo se transforma". Los 치tomos se reordenan."
                    },
                    {
                        question: "Si reaccionan 10g de A con 5g de B, 쯖u치nta masa de productos se obtendr치?",
                        options: ["10g", "5g", "15g", "No se puede saber"],
                        answer: 2,
                        explanation: "춰Error! Ley de Lavoisier: Masa Reactivos = Masa Productos. Si entran 10g + 5g = 15g, deben salir 15g de productos."
                    },
                    {
                        question: "En la reacci칩n $CH_4 + 2 O_2 \rightarrow CO_2 + 2 H_2O$, 쯤u칠 es el $CH_4$?",
                        options: ["Producto", "Reactivo", "Catalizador", "Elemento"],
                        answer: 1,
                        explanation: "Negativo. El $CH_4$ (Metano) est치 a la izquierda de la flecha, es una de las sustancias que reaccionan. Es un reactivo."
                    },
                    {
                        question: "En la misma reacci칩n ($CH_4 + 2 O_2 \rightarrow CO_2 + 2 H_2O$), 쯤u칠 es el $CO_2$?",
                        options: ["Producto", "Reactivo", "Ambos", "Compuesto inicial"],
                        answer: 0,
                        explanation: "Fallo. El $CO_2$ (Di칩xido de Carbono) est치 a la derecha de la flecha, es una sustancia nueva que se forma. Es un producto."
                    },
                    {
                        question: "Si quemas 50g de papel y recoges 48g de cenizas, 쯤u칠 pas칩 con los 2g que faltan?",
                        options: ["Se destruyeron", "Se convirtieron en energ칤a", "Se transformaron en gases (ej. CO2)", "Es un error de Lavoisier"],
                        answer: 2,
                        explanation: "춰Incorrecto! La masa no se destruye. Esos 2g (o m치s) se han ido en forma de gases (como CO2 y vapor de agua) que no has pesado."
                    },
                    {
                        question: "쯈u칠 nos dice la Ley de Lavoisier a nivel at칩mico?",
                        options: ["Los 치tomos cambian", "Se crean 치tomos nuevos", "El n칰mero de 치tomos de cada elemento se conserva", "Los 치tomos se destruyen"],
                        answer: 2,
                        explanation: "Error del sistema. La ley implica que los 치tomos solo se reordenan. Debe haber el mismo n칰mero de 치tomos de Carbono (por ej.) en los reactivos y en los productos."
                    },
                    {
                        question: "Las sustancias que tenemos DESPU칄S de la reacci칩n se llaman...",
                        options: ["Reactivos", "Iniciales", "Productos", "Elementos"],
                        answer: 2,
                        explanation: "Fallo. Las sustancias nuevas, resultado de la transformaci칩n (a la derecha de la flecha), son los PRODUCTOS."
                    }
                ]
            },
            {
                name: "M칩dulo 3: Ajuste y Tipos de Reacci칩n",
                codeDigit: 9,
                completed: false,
                questions: [
                    {
                        question: "Ajustar una reacci칩n es asegurarse de que cumple la Ley de...",
                        options: ["Newton", "Dalton", "Lavoisier", "Einstein"],
                        answer: 2,
                        explanation: "Negativo. Ajustamos reacciones para que haya el mismo n췈 de 치tomos en ambos lados, cumpliendo la Ley de Conservaci칩n de la Masa (Lavoisier)."
                    },
                    {
                        question: "Para ajustar una reacci칩n, 쯤u칠 NUNCA debes cambiar?",
                        options: ["Los Coeficientes (n칰meros grandes)", "Los Sub칤ndices (n칰meros peque침os)", "Las flechas", "Los reactivos"],
                        answer: 1,
                        explanation: "춰춰ERROR CR칈TICO!! Si cambias el sub칤ndice (ej. $H_2O$ a $H_2O_2$) cambias la sustancia. Solo puedes poner Coeficientes delante."
                    },
                    {
                        question: "Los n칰meros grandes que se ponen delante de las f칩rmulas se llaman...",
                        options: ["Sub칤ndices", "Coeficientes estequiom칠tricos", "N칰meros at칩micos", "Productos"],
                        answer: 1,
                        explanation: "Fallo. Los n칰meros grandes (ej. el '2' en $2 H_2O$) se llaman coeficientes estequiom칠tricos."
                    },
                    {
                        question: "La reacci칩n $A + B \rightarrow C$ es de tipo...",
                        options: ["Descomposici칩n", "S칤ntesis (o Combinaci칩n)", "Combusti칩n", "Oxidaci칩n simple"],
                        answer: 1,
                        explanation: "Incorrecto. Dos reactivos simples se unen para formar un producto m치s complejo. Es una S칈NTESIS."
                    },
                    {
                        question: "La reacci칩n $A \rightarrow B + C$ es de tipo...",
                        options: ["Descomposici칩n", "S칤ntesis", "Combusti칩n", "Oxidaci칩n"],
                        answer: 0,
                        explanation: "Error. Un reactivo complejo se 'rompe' en dos o m치s productos simples. Es una DESCOMPOSICI칍N."
                    },
                    {
                        question: "La reacci칩n de la gasolina en un coche es una...",
                        options: ["S칤ntesis", "Descomposici칩n", "Combusti칩n", "Reacci칩n lenta"],
                        answer: 2,
                        explanation: "Negativo. Es una oxidaci칩n muy r치pida que libera mucha energ칤a (calor y luz). Es una COMBUSTI칍N."
                    },
                    {
                        question: "Una Combusti칩n necesita un combustible (ej. madera) y un...",
                        options: ["Catalizador", "Producto", "Comburente (normalmente O2)", "Compuesto"],
                        answer: 2,
                        explanation: "Fallo. Para que algo arda se necesita un comburente, que casi siempre es el Ox칤geno ($O_2$)."
                    },
                    {
                        question: "La oxidaci칩n del hierro (formar 칩xido) es una reacci칩n donde se combina con...",
                        options: ["Agua", "Nitr칩geno", "Carbono", "Ox칤geno"],
                        answer: 3,
                        explanation: "Error. La definici칩n original de OXIDACI칍N es la combinaci칩n de una sustancia con el OX칈GENO."
                    },
                    {
                        question: "쮼st치 ajustada la reacci칩n $H_2 + O_2 \rightarrow H_2O$?",
                        options: ["S칤", "No", "Solo a veces", "Imposible saberlo"],
                        answer: 1,
                        explanation: "춰Incorrecto! Hay 2 Ox칤genos en reactivos ($O_2$) y solo 1 en productos ($H_2O$). NO est치 ajustada."
                    },
                    {
                        question: "쮺u치l es la reacci칩n $H_2 + Cl_2 \rightarrow 2 HCl$?",
                        options: ["S칤ntesis", "Descomposici칩n", "Combusti칩n", "F칤sica"],
                        answer: 0,
                        explanation: "Fallo. Dos reactivos ($H_2$ y $Cl_2$) se combinan para dar un solo producto ($HCl$). Es una S칈NTESIS."
                    }
                ]
            },
            {
                name: "M칩dulo 4: Velocidad de Reacci칩n",
                codeDigit: 1,
                completed: false,
                questions: [
                    {
                        question: "Si aumentas la TEMPERATURA, la velocidad de reacci칩n...",
                        options: ["Aumenta", "Disminuye", "No cambia", "Depende"],
                        answer: 0,
                        explanation: "Error. A mayor temperatura, las part칤culas se mueven m치s r치pido, chocan m치s y con m치s energ칤a. La velocidad AUMENTA."
                    },
                    {
                        question: "Si aumentas la CONCENTRACI칍N de reactivos, la velocidad...",
                        options: ["Disminuye", "No cambia", "Aumenta", "Se detiene"],
                        answer: 2,
                        explanation: "Negativo. A mayor concentraci칩n, hay m치s part칤culas de reactivo en el mismo espacio, por lo que chocan m치s veces. La velocidad AUMENTA."
                    },
                    {
                        question: "Para que reaccione un s칩lido (ej. una pastilla), 쯤u칠 es mejor?",
                        options: ["Dejar la pastilla entera", "Partirla en dos", "Triturarla (hacerla polvo)", "Mojarla primero"],
                        answer: 2,
                        explanation: "Fallo. Al triturar el s칩lido, aumentas la SUPERFICIE DE CONTACTO. La reacci칩n solo ocurre en la superficie, as칤 que ir치 m치s r치pido."
                    },
                    {
                        question: "Una sustancia que acelera una reacci칩n sin gastarse se llama...",
                        options: ["Reactivo", "Producto", "Catalizador", "Comburente"],
                        answer: 2,
                        explanation: "춰Incorrecto! Esos son los CATALIZADORES. Son 'ayudantes' que ofrecen un camino m치s f치cil para la reacci칩n."
                    },
                    {
                        question: "Guardar la comida en la nevera... (bajar la temperatura)",
                        options: ["Acelera su descomposici칩n", "Frena su descomposici칩n", "No hace nada", "La cuece"],
                        answer: 1,
                        explanation: "Error. Bajar la temperatura hace que las reacciones de descomposici칩n (putrefacci칩n) vayan m치s lentas. Por eso la comida dura m치s."
                    },
                    {
                        question: "쯇or qu칠 arde m치s r치pido una astilla que un tronco?",
                        options: ["Por la temperatura", "Por la concentraci칩n", "Por la superficie de contacto", "Por el catalizador"],
                        answer: 2,
                        explanation: "Negativo. La astilla, para la misma cantidad de madera, tiene m치s superficie expuesta al ox칤geno. Es por la SUPERFICIE DE CONTACTO."
                    },
                    {
                        question: "Las enzimas de tu cuerpo que ayudan a digerir son ejemplos de...",
                        options: ["Reactivos", "Catalizadores (biol칩gicos)", "Productos", "츼cidos"],
                        answer: 1,
                        explanation: "Fallo del sistema. Las enzimas son catalizadores biol칩gicos: aceleran las reacciones de la digesti칩n sin gastarse."
                    },
                    {
                        question: "Si hay m치s choques entre las part칤culas de reactivos, la velocidad...",
                        options: ["Aumenta", "Disminuye", "Es cero", "Se para"],
                        answer: 0,
                        explanation: "Correcto, pero has fallado. La base de la velocidad es el n칰mero de choques eficaces. M치s choques = M치s velocidad."
                    },
                    {
                        question: "Factor que NO influye (seg칰n el PDF) en la velocidad:",
                        options: ["Temperatura", "Presencia de catalizadores", "El color del recipiente", "Concentraci칩n"],
                        answer: 2,
                        explanation: "Error. El color del recipiente no afecta (a menos que influya en la temperatura, pero no es un factor directo)."
                    },
                    {
                        question: "Los catalizadores...",
                        options: ["Se gastan en la reacci칩n", "Frenan la reacci칩n", "Aumentan la velocidad sin gastarse", "Son siempre l칤quidos"],
                        answer: 2,
                        explanation: "Negativo. La definici칩n de catalizador es que AUMENTA la velocidad y NO se gasta en el proceso."
                    }
                ]
            }
        ];

        // --- VARIABLES DE ESTADO DEL JUEGO ---
        let currentSectionIndex = 0;
        let currentQuestionIndex = 0;
        let lives = 5;
        let earnedDigits = ["?", "?", "?", "?"];
        const correctCode = "7391";

        // --- REFERENCIAS A ELEMENTOS DEL DOM ---
        const screens = document.querySelectorAll('.screen');
        const introScreen = document.getElementById('intro-screen');
        const sectionScreen = document.getElementById('section-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const gameoverScreen = document.getElementById('gameover-screen');
        const sectionCompleteScreen = document.getElementById('section-complete-screen');
        const finalCodeScreen = document.getElementById('final-code-screen');
        const winScreen = document.getElementById('win-screen');

        const startButton = document.getElementById('start-button');
        const sectionButtonsContainer = document.getElementById('section-buttons');
        const gotoCodeScreenButton = document.getElementById('goto-code-screen-button');

        const sectionTitle = document.getElementById('section-title');
        const questionCounter = document.getElementById('question-counter');
        const livesCounter = document.getElementById('lives-counter');
        const questionText = document.getElementById('question-text');
        const answersList = document.getElementById('answers-list');
        const feedbackMessage = document.getElementById('feedback-message');

        const restartSectionButton = document.getElementById('restart-section-button');
        const backToMenuButton = document.getElementById('back-to-menu-button');
        const nextSectionButton = document.getElementById('next-section-button');
        const earnedDigitText = document.getElementById('earned-digit-text');
        
        const finalDigitsDisplay = document.getElementById('final-digits-display');
        const codeInputs = [
            document.getElementById('code-1'),
            document.getElementById('code-2'),
            document.getElementById('code-3'),
            document.getElementById('code-4')
        ];
        const checkCodeButton = document.getElementById('check-code-button');
        const codeErrorMessage = document.getElementById('code-error-message');
        const backToMenuFromCodeButton = document.getElementById('back-to-menu-from-code-button');

        // --- FUNCIONES DEL JUEGO ---

        // Funci칩n para cambiar entre pantallas
        function showScreen(screenElement) {
            screens.forEach(s => s.classList.remove('active'));
            screenElement.classList.add('active');
        }

        // Mover foco en inputs de c칩digo
        function moveToNext(current, nextFieldId) {
            if (current.value.length >= current.maxLength) {
                if (nextFieldId) {
                    document.getElementById(nextFieldId).focus();
                }
            }
        }
        
        // Rellenar la pantalla de selecci칩n de m칩dulos
        function populateSectionScreen() {
            sectionButtonsContainer.innerHTML = '';
            quizData.forEach((section, index) => {
                const button = document.createElement('div');
                button.classList.add('pip-button');
                button.textContent = section.name;
                if (section.completed) {
                    button.textContent += " (COMPLETADO)";
                    button.setAttribute('disabled', true);
                } else {
                    button.onclick = () => startQuiz(index);
                }
                sectionButtonsContainer.appendChild(button);
            });
            
            // Comprobar si todas las secciones est치n completadas
            const allCompleted = quizData.every(section => section.completed);
            if (allCompleted) {
                gotoCodeScreenButton.classList.remove('hidden');
            }
        }

        // Iniciar un m칩dulo de quiz
        function startQuiz(sectionIndex) {
            currentSectionIndex = sectionIndex;
            currentQuestionIndex = 0;
            lives = 5;
            updateLivesDisplay();
            sectionTitle.textContent = quizData[currentSectionIndex].name;
            loadQuestion();
            showScreen(quizScreen);
        }

        // Cargar la pregunta actual
        function loadQuestion() {
            feedbackMessage.classList.add('hidden');
            feedbackMessage.textContent = '';
            
            if (currentQuestionIndex >= quizData[currentSectionIndex].questions.length) {
                sectionComplete();
                return;
            }

            const q = quizData[currentSectionIndex].questions[currentQuestionIndex];
            questionText.textContent = q.question;
            questionCounter.textContent = `Pregunta ${currentQuestionIndex + 1}/10`;
            answersList.innerHTML = '';

            q.options.forEach((option, index) => {
                const li = document.createElement('li');
                li.textContent = option;
                li.onclick = () => selectAnswer(index);
                answersList.appendChild(li);
            });
        }

        // Procesar la respuesta seleccionada
        function selectAnswer(selectedIndex) {
            const q = quizData[currentSectionIndex].questions[currentQuestionIndex];
            
            // Deshabilitar botones para evitar doble click
            const options = answersList.querySelectorAll('li');
            options.forEach(opt => opt.onclick = null);

            if (selectedIndex === q.answer) {
                // Correcto
                feedbackMessage.textContent = ">>> Correcto. Procesando siguiente consulta...";
                feedbackMessage.classList.remove('hidden', 'feedback-incorrect');
                feedbackMessage.classList.add('feedback-correct');
                currentQuestionIndex++;
                setTimeout(loadQuestion, 1500);
            } else {
                // Incorrecto
                lives--;
                updateLivesDisplay();
                feedbackMessage.innerHTML = `> FALLO: ${q.explanation}`;
                feedbackMessage.classList.remove('hidden', 'feedback-correct');
                feedbackMessage.classList.add('feedback-incorrect');

                if (lives <= 0) {
                    setTimeout(gameOver, 2000);
                } else {
                    // Carga la misma pregunta de nuevo
                    setTimeout(loadQuestion, 3000); 
                    // No, el usuario pierde vida pero avanza.
                    currentQuestionIndex++;
                    setTimeout(loadQuestion, 3500); // Espera 3.5s para que lea la explicaci칩n
                }
            }
        }

        // Actualizar el contador de vidas
        function updateLivesDisplay() {
            const heartIcon = '仇벒잺';
            const lostIcon = '游둯';
            livesCounter.textContent = `Integridad: ${heartIcon.repeat(lives)}${lostIcon.repeat(5 - lives)}`;
        }

        // Fin del juego (secci칩n)
        function gameOver() {
            showScreen(gameoverScreen);
        }

        // Secci칩n completada
        function sectionComplete() {
            quizData[currentSectionIndex].completed = true;
            const digit = quizData[currentSectionIndex].codeDigit;
            earnedDigits[currentSectionIndex] = digit;
            earnedDigitText.textContent = digit;
            showScreen(sectionCompleteScreen);
        }
        
        // Mostrar pantalla de c칩digo final
        function showFinalCode() {
            finalDigitsDisplay.textContent = earnedDigits.join(' - ');
            codeInputs.forEach(input => input.value = '');
            codeErrorMessage.textContent = '';
            showScreen(finalCodeScreen);
        }
        
        // Validar el c칩digo final
        function checkFinalCode() {
            const inputCode = codeInputs.map(input => input.value).join('');
            if (inputCode === correctCode) {
                showScreen(winScreen);
            } else {
                codeErrorMessage.textContent = ">>> C칍DIGO INCORRECTO. ESCLUSA BLOQUEADA. <<<";
                codeInputs.forEach(input => input.value = '');
                codeInputs[0].focus();
            }
        }

        // --- INICIALIZACI칍N Y EVENT LISTENERS ---
        
        startButton.onclick = () => {
            populateSectionScreen();
            showScreen(sectionScreen);
        };
        
        nextSectionButton.onclick = () => {
            populateSectionScreen();
            showScreen(sectionScreen);
        };
        
        backToMenuButton.onclick = () => {
            populateSectionScreen();
            showScreen(sectionScreen);
        };
        
        restartSectionButton.onclick = () => {
            startQuiz(currentSectionIndex); // Reinicia la misma secci칩n
        };
        
        gotoCodeScreenButton.onclick = showFinalCode;
        checkCodeButton.onclick = checkFinalCode;
        
        backToMenuFromCodeButton.onclick = () => {
            populateSectionScreen();
            showScreen(sectionScreen);
        };

        // Iniciar en la pantalla de intro
        showScreen(introScreen);

    </script>
</body>
</html>
